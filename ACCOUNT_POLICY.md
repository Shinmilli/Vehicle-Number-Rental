# 계정 중복 정책 및 추천 방안

## 현재 시스템 분석

### 현재 제약 조건
- **전화번호**: `@unique` - 하나의 전화번호로 하나의 계정만 가능
- **이메일**: `@unique` - 하나의 이메일로 하나의 계정만 가능
- **로그인 방식**: 전화번호 또는 이메일로 로그인 가능
- **OAuth**: 이메일로 기존 계정 찾기

## 문제 시나리오

### 시나리오 1: 같은 전화번호, 다른 이메일, 다른 비밀번호
```
사용자 A: 전화번호 010-1111-2222, 이메일 a@example.com, 비밀번호 pass1
사용자 B: 전화번호 010-1111-2222, 이메일 b@example.com, 비밀번호 pass2
```
**현재 동작**: 전화번호 중복으로 회원가입 불가능 ✅ (올바른 동작)

### 시나리오 2: 다른 전화번호, 같은 이메일, 다른 비밀번호
```
사용자 A: 전화번호 010-1111-2222, 이메일 a@example.com, 비밀번호 pass1
사용자 B: 전화번호 010-2222-3333, 이메일 a@example.com, 비밀번호 pass2
```
**현재 동작**: 이메일 중복으로 회원가입 불가능 ✅ (올바른 동작)

### 시나리오 3: OAuth 로그인 시 기존 계정과 이메일 일치
```
기존 계정: 전화번호 010-1111-2222, 이메일 a@example.com, 비밀번호 pass1
OAuth 로그인: 이메일 a@example.com (카카오/구글)
```
**현재 동작**: 이메일로 기존 계정 찾아서 로그인 ✅ (올바른 동작)

## 추천 방안

### ✅ 방안 1: 현재 시스템 유지 (권장)

**정책**:
- 전화번호와 이메일을 각각 unique로 유지
- 하나의 전화번호 = 하나의 계정
- 하나의 이메일 = 하나의 계정
- 같은 전화번호/이메일이면 같은 계정으로 간주

**장점**:
- 명확하고 단순한 정책
- 데이터베이스 제약으로 자동 보호
- 보안성 높음 (계정 도용 방지)

**단점**:
- 전화번호나 이메일을 변경하면 새 계정 생성 불가능

**로그인 플로우**:
1. 전화번호 또는 이메일로 계정 찾기
2. 비밀번호 확인
3. 비밀번호가 다르면 "전화번호/이메일 또는 비밀번호가 잘못되었습니다" 에러

### 방안 2: 전화번호 + 이메일 조합으로 중복 판단

**정책**:
- 전화번호와 이메일의 조합으로 계정 식별
- 같은 전화번호 + 같은 이메일 = 같은 계정
- 같은 전화번호 + 다른 이메일 = 다른 계정 가능
- 다른 전화번호 + 같은 이메일 = 다른 계정 가능

**장점**:
- 더 유연한 계정 관리
- 같은 전화번호로 여러 계정 생성 가능

**단점**:
- 복잡한 로직 필요
- 보안 위험 증가 (계정 도용 가능)
- 로그인 시 전화번호와 이메일 모두 필요할 수 있음

**비추천 이유**: 보안과 사용자 경험 측면에서 불리

### 방안 3: 이메일 중심 정책 (OAuth 친화적)

**정책**:
- 이메일만 unique로 유지
- 전화번호는 중복 허용
- 이메일로 계정 식별

**장점**:
- OAuth 로그인과 자연스럽게 통합
- 이메일이 주 식별자

**단점**:
- 전화번호로는 계정 구분 불가능
- 같은 전화번호로 여러 계정 생성 가능 (보안 위험)

**비추천 이유**: 전화번호로 로그인하는 현재 시스템과 맞지 않음

## 최종 추천: 방안 1 (현재 시스템 유지)

### 이유
1. **보안성**: 전화번호와 이메일 모두 unique로 보호
2. **명확성**: 정책이 단순하고 이해하기 쉬움
3. **일관성**: 로그인 시 전화번호 또는 이메일로 계정 찾기 가능
4. **OAuth 통합**: 이메일로 기존 계정 찾아서 자연스럽게 통합

### 개선 제안

#### 1. 계정 복구 기능 추가 (선택사항)
- 비밀번호 찾기: 이메일 또는 전화번호로 인증 후 비밀번호 재설정
- 계정 찾기: 이메일 또는 전화번호로 계정 확인

#### 2. OAuth 계정 연결 개선
- OAuth 로그인 시 이메일로 기존 계정 찾기 ✅ (현재 구현됨)
- 기존 계정이 있으면 OAuth로 로그인
- 기존 계정이 없으면 새 계정 생성

#### 3. 에러 메시지 개선
```typescript
// 현재
"이미 등록된 전화번호입니다."
"이미 등록된 이메일입니다."

// 개선 (선택사항)
"이미 등록된 전화번호입니다. 로그인하시거나 비밀번호 찾기를 이용해주세요."
"이미 등록된 이메일입니다. 로그인하시거나 비밀번호 찾기를 이용해주세요."
```

## 결론

**현재 시스템이 가장 적합합니다.**
- 전화번호와 이메일을 각각 unique로 유지
- 같은 전화번호/이메일이면 같은 계정
- 비밀번호가 다르면 "비밀번호가 잘못되었습니다" 에러
- OAuth 로그인 시 이메일로 기존 계정 자동 연결

추가로 비밀번호 찾기 기능을 구현하면 사용자 경험이 더 좋아집니다.

