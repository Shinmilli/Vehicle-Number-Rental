# OAuth 로그인 동작 방식

## 현재 동작 방식

### 1. 로그인 vs 회원가입

OAuth 로그인은 **자동으로 로그인/회원가입을 처리**합니다:

1. **이메일로 기존 사용자 찾기**
   - 이메일이 고유 식별자로 사용됨
   - 기존 사용자가 있으면 → **로그인**
   - 기존 사용자가 없으면 → **회원가입** (자동 생성)

2. **로그인 플로우**
   ```
   카카오/구글 로그인 클릭
   → OAuth 인증
   → 사용자 정보 가져오기 (이메일, 이름)
   → 이메일로 DB에서 사용자 찾기
   → 있으면: 기존 계정으로 로그인 ✅
   → 없으면: 새 계정 생성 후 로그인 ✅
   ```

### 2. 같은 이메일로 다른 OAuth 제공자 로그인

**현재 동작**: 같은 이메일이면 **동일한 계정**으로 로그인됩니다.

**예시**:
- 카카오로 가입: `user@example.com` → 계정 생성
- 구글로 로그인: `user@example.com` → **같은 계정으로 로그인**

**이유**:
- 이메일이 고유 식별자로 사용됨
- 같은 이메일 = 같은 사람으로 간주
- 여러 OAuth 제공자를 하나의 계정으로 통합

**장점**:
- 사용자가 어떤 OAuth 제공자로 로그인해도 같은 계정 사용
- 계정 관리가 단순함

**단점**:
- 다른 사람이 같은 이메일을 사용하면 계정이 공유됨 (드문 경우)

### 3. 카카오 로그인 실패 문제

**현재 문제**: 카카오 인증이 Redirect URI 불일치로 실패하여 `handleOAuthLogin`까지 도달하지 못함

**원인**:
- 카카오 개발자 콘솔의 Redirect URI와 서버 환경 변수의 URI가 일치하지 않음
- 또는 인증 코드가 이미 사용됨 (일회용)

**해결 방법**:
1. 카카오 개발자 콘솔 확인
   - 제품 설정 → 카카오 로그인 → Redirect URI
   - 정확히 `http://localhost:3000/oauth/kakao/callback` 등록 확인
2. 서버 환경 변수 확인
   - `.env` 파일의 `KAKAO_REDIRECT_URI` 확인
   - 앞뒤 공백 없이 정확히 일치해야 함
3. 새로 로그인 시도
   - 인증 코드는 일회용이므로 새로 시도해야 함

## 개선 제안

### 옵션 1: 현재 방식 유지 (권장)
- 같은 이메일 = 같은 계정
- 여러 OAuth 제공자를 하나의 계정으로 통합
- 사용자 경험 단순함

### 옵션 2: OAuth 제공자별 계정 분리
- 카카오와 구글을 별도 계정으로 관리
- 같은 이메일이라도 다른 계정
- 복잡도 증가

### 옵션 3: OAuth 제공자 연결 관리
- 기본 계정에 여러 OAuth 제공자 연결
- 사용자가 직접 연결 관리
- 가장 복잡하지만 유연함

## 현재 권장 사항

**현재 방식(옵션 1)을 유지하는 것을 권장합니다.**

이유:
1. 사용자 경험 단순함
2. 대부분의 서비스에서 사용하는 방식
3. 구현이 간단하고 안정적

다만, 카카오 인증 문제를 해결해야 합니다.

