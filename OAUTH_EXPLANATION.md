# OAuth 인증 코드가 필요한 이유

## 왜 매번 인증 코드가 필요한가?

### OAuth 2.0 표준 플로우

OAuth는 **매번 새로운 인증**이 필요합니다. 이는 보안을 위한 설계입니다.

```
1. 사용자가 "카카오로 로그인" 클릭
   ↓
2. 카카오 인증 페이지로 이동
   ↓
3. 사용자가 카카오에서 로그인/동의
   ↓
4. 카카오가 인증 코드를 발급 (일회용, 10분 유효)
   ↓
5. 프론트엔드로 리다이렉트: /oauth/kakao/callback?code=xxx
   ↓
6. 프론트엔드가 서버로 인증 코드 전달
   ↓
7. 서버가 카카오에 인증 코드를 보내서 액세스 토큰 받음
   ↓
8. 서버가 액세스 토큰으로 사용자 정보 가져옴
   ↓
9. 서버가 DB에서 사용자 찾기/생성
   ↓
10. 서버가 JWT 토큰 생성해서 프론트엔드로 전달
   ↓
11. 프론트엔드가 JWT 토큰 저장 (이게 실제 로그인 상태)
```

### 인증 코드가 필요한 이유

1. **보안**: 인증 코드는 일회용이고 짧은 시간(약 10분)만 유효
2. **표준**: OAuth 2.0 표준 플로우
3. **사용자 동의**: 매번 사용자가 명시적으로 동의해야 함

### 이미 로그인되어 있으면?

**현재 시스템**:
- JWT 토큰이 localStorage에 저장됨
- 페이지 새로고침 시 자동으로 로그인 상태 복원
- 로그인 페이지 접근 시 자동으로 대시보드로 리다이렉트 (개선됨)

**OAuth 로그인은 여전히 필요**:
- 카카오/구글 로그인 버튼을 클릭하면 매번 새로운 인증 코드가 필요
- 이는 OAuth 표준이며, 보안을 위한 설계

## 개선 사항

### 1. 이미 로그인된 경우 자동 리다이렉트

로그인 페이지에 접근했을 때 이미 로그인되어 있으면 자동으로 대시보드로 이동합니다.

```typescript
// LoginPage.tsx
useEffect(() => {
  if (isAuthenticated) {
    if (userType === "company") {
      navigate("/company/dashboard", { replace: true });
    } else if (userType === "user") {
      navigate("/driver/dashboard", { replace: true });
    }
  }
}, [isAuthenticated, userType, navigate]);
```

### 2. OAuth 로그인 플로우

OAuth 로그인은 매번 인증 코드가 필요하지만, 이는 정상적인 동작입니다:

- **첫 로그인**: 회원가입 + 로그인
- **이후 로그인**: 로그인만 (기존 계정 사용)

## 요약

- **인증 코드는 매번 필요**: OAuth 2.0 표준이며 보안을 위한 설계
- **이미 로그인되어 있으면**: 자동으로 대시보드로 이동 (개선됨)
- **OAuth 로그인 버튼 클릭 시**: 매번 카카오/구글 인증이 필요 (정상 동작)

